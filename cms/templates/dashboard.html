<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard - nanoCMS</title>
    <!-- icons and manifest -->
  <link rel="apple-touch-icon" sizes="180x180" href="{{ url_for('static', filename='apple-touch-icon.png') }}">
  <link rel="icon" type="image/png" sizes="32x32" href="{{ url_for('static', filename='favicon-32x32.png') }}">
  <link rel="icon" type="image/png" sizes="16x16" href="{{ url_for('static', filename='favicon-16x16.png') }}">
  <link rel="manifest" href="{{ url_for('static', filename='site.webmanifest') }}">
  <!-- styles -->
  <link href="{{ url_for('static', filename='css/bootstrap/bootstrap.min.css') }}" rel="stylesheet">
  <script src="{{ url_for('static', filename='js/bootstrap/bootstrap.bundle.min.js') }}"></script>
</head>

<body>
  
  <nav class="navbar navbar-light bg-light px-3 d-flex justify-content-between">
    <a href="{{ url_for('main.dashboard') }}" class="navbar-brand mb-0 h1" style="text-decoration: none; color: inherit;">nanoCMS</a>
    <div class="d-flex align-items-center" style="gap: 0.5em;">
      <a href="{{ url_for('main.help_view') }}" class="btn btn-outline-info">Help</a>
      <a href="{{ url_for('main.settings') }}" class="btn btn-outline-warning">Settings</a>
      <a href="{{ url_for('main.logout') }}" class="btn btn-outline-secondary">Logout</a>
    </div>
  </nav>

  <div class="container mt-4">
    <h3 class="mb-3">Streams</h3>

    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          <div class="alert alert-{{ category }}">{{ message }}</div>
        {% endfor %}
      {% endif %}
    {% endwith %}


    <form method="POST" class="mb-2">
  <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
      <div class="input-group mb-2">
        <input type="text" name="add_stream" class="form-control" placeholder="New stream name" required>
        <button type="submit" class="btn btn-success">Add Stream</button>
      </div>
    </form>



    <ul class="list-group mb-4">
      {% for stream in streams %}
        <li class="list-group-item d-flex flex-wrap justify-content-between align-items-center py-3">
          <div class="d-flex align-items-center flex-wrap" style="gap: 1em;">
            <a href="/edit/{{ stream }}" class="btn btn-sm btn-primary">Edit</a>
            <form method="POST" class="d-flex" style="gap:0.5em;display:inline;">
              <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
              <input type="hidden" name="rename_stream" value="{{ stream }}">
              <div class="input-group input-group-sm" style="width: 180px;">
                <input type="text" name="new_stream_name" class="form-control" placeholder="Rename" required>
                <button type="submit" class="btn btn-outline-secondary">Rename</button>
              </div>
            </form>
            <span class="fs-5 fw-semibold">
              {{ stream }}
              {% if stream_upload_counts[stream] > 0 %}
                - {{ stream_upload_counts[stream] }} <span title="attachments">üñáÔ∏è</span>
              {% endif %}
            </span>
          </div>
          <div class="d-flex align-items-center flex-wrap" style="gap: 0.5em;">
            <form method="POST" style="display:inline;">
              <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
              <input type="hidden" name="remove_stream" value="{{ stream }}">
              <button type="submit" class="btn btn-sm btn-outline-danger" title="Delete" onclick="return confirm('Delete stream & uploads?')">
                <span class="bi bi-trash"></span> Delete
              </button>
            </form>
          </div>
        </li>
      {% endfor %}
    </ul>
  </div>
</body>
</html>
